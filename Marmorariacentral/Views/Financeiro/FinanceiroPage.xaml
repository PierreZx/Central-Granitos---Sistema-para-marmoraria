<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:Marmorariacentral.Models"
             xmlns:viewmodels="clr-namespace:Marmorariacentral.ViewModels"
             x:Class="Marmorariacentral.Views.Financeiro.FinanceiroPage"
             x:DataType="viewmodels:FinanceiroViewModel"
             Title="GestÃ£o Financeira"
             BackgroundColor="#F2F2F7">

    <Grid RowDefinitions="Auto, Auto, Auto, *">

        <!-- SALDO -->
        <Border Grid.Row="0" Padding="20" BackgroundColor="#8B1A1A" StrokeThickness="0">
            <VerticalStackLayout>
                <Label Text="Saldo em Caixa" TextColor="#FFCCCC" FontSize="12"/>
                <Label Text="{Binding SaldoTotal, StringFormat='{0:C}'}"
                       TextColor="White"
                       FontSize="28"
                       FontAttributes="Bold"/>
            </VerticalStackLayout>
        </Border>

        <!-- TABS -->
        <FlexLayout Grid.Row="1" JustifyContent="SpaceAround" Padding="5" BackgroundColor="White">
            <Button x:Name="BtnTabContas" Text="Contas" FontAttributes="Bold"
                    BackgroundColor="Transparent"
                    TextColor="#8B1A1A"
                    Clicked="OnTabClicked"
                    CommandParameter="Contas"/>

            <Button x:Name="BtnTabExtrato" Text="Extrato"
                    BackgroundColor="Transparent"
                    TextColor="#777"
                    Clicked="OnTabClicked"
                    CommandParameter="Extrato"/>

            <Button Text="ProduÃ§Ã£o"
                    BackgroundColor="Transparent"
                    TextColor="#CCC"
                    Clicked="OnTabClicked"
                    CommandParameter="Producao"/>
        </FlexLayout>

        <!-- AÃ‡Ã•ES -->
        <VerticalStackLayout Grid.Row="2" Padding="15" Spacing="10" BackgroundColor="#F8F8F8">
    
            <Button x:Name="BtnLancar" 
                    Text="+ CADASTRAR CONTA"
                    BackgroundColor="#8B1A1A"
                    TextColor="White"
                    CornerRadius="10"
                    HeightRequest="45"
                    Command="{Binding AbrirCadastroCommand}"/>

            <Grid ColumnDefinitions="*, *" ColumnSpacing="10">
                <SearchBar Grid.Column="0" 
                        Placeholder="Filtrar..."
                        HeightRequest="40"
                        TextChanged="OnSearchTextChanged"
                        BackgroundColor="White"/>

                <Picker Grid.Column="1" 
                        Title="Ordenar..."
                        HeightRequest="40"
                        SelectedIndexChanged="OnSortChanged"
                        BackgroundColor="White">
                    <Picker.ItemsSource>
                        <x:Array Type="{x:Type x:String}">
                            <x:String>Vencimento</x:String>
                            <x:String>Maior Valor</x:String>
                            <x:String>Menor Valor</x:String>
                        </x:Array>
                    </Picker.ItemsSource>
                </Picker>
            </Grid>
        </VerticalStackLayout>

        <!-- LISTAS -->
        <Grid Grid.Row="3">

            <!-- CONTAS -->
            <CollectionView x:Name="ListContas"
                            ItemsSource="{Binding ContasAtivas}"
                            IsVisible="True">

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:FinanceiroRegistro">

                        <ContentView Padding="15,5">

                            <Border Padding="12"
                                    StrokeShape="RoundRectangle 12"
                                    BackgroundColor="White">

                                <Grid ColumnDefinitions="Auto, *, Auto, Auto"
                                      ColumnSpacing="8">

                                    <Ellipse Grid.Column="0"
                                             WidthRequest="12"
                                             HeightRequest="12"
                                             Fill="{Binding StatusColor}"
                                             VerticalOptions="Center"/>

                                    <VerticalStackLayout Grid.Column="1">
                                        <Label Text="{Binding Descricao}"
                                               FontAttributes="Bold"/>
                                        <Label Text="{Binding DataVencimento, StringFormat='Vence: {0:dd/MM}'}"
                                               FontSize="11"
                                               TextColor="#777"/>
                                    </VerticalStackLayout>

                                    <VerticalStackLayout Grid.Column="2"
                                                         HorizontalOptions="End">

                                        <Label Text="{Binding Valor, StringFormat='{0:C}'}"
                                               FontAttributes="Bold"/>

                                        <HorizontalStackLayout Spacing="2">
                                            <Label Text="Pagar?" FontSize="9"/>
                                            <CheckBox IsChecked="{Binding FoiPago}"
                                                      CheckedChanged="OnPagoChanged"
                                                      Scale="0.8"/>
                                        </HorizontalStackLayout>

                                    </VerticalStackLayout>

                                    <HorizontalStackLayout Grid.Column="3"
                                                           Spacing="5">

                                        <Button Text="âœŽ"
                                                WidthRequest="32"
                                                HeightRequest="32"
                                                BackgroundColor="#F0F0F0"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FinanceiroViewModel}}, Path=EditarRegistroCommand}"
                                                CommandParameter="{Binding .}"/>

                                        <Button Text="X"
                                                WidthRequest="32"
                                                HeightRequest="32"
                                                BackgroundColor="#FFEBEB"
                                                TextColor="Red"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FinanceiroViewModel}}, Path=ExcluirRegistroCommand}"
                                                CommandParameter="{Binding .}"/>
                                    </HorizontalStackLayout>

                                </Grid>
                            </Border>
                        </ContentView>

                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- EXTRATO -->
            <CollectionView x:Name="ListExtrato"
                            ItemsSource="{Binding ExtratoDia}"
                            IsVisible="False">

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:FinanceiroRegistro">

                        <ContentView Padding="15,5">

                            <Border Padding="15"
                                    StrokeShape="RoundRectangle 12">

                                <Border.Triggers>
                                    <DataTrigger TargetType="Border"
                                                 Binding="{Binding Tipo}"
                                                 Value="Entrada">
                                        <Setter Property="BackgroundColor"
                                                Value="#E8F5E9"/>
                                    </DataTrigger>

                                    <DataTrigger TargetType="Border"
                                                 Binding="{Binding Tipo}"
                                                 Value="Saida">
                                        <Setter Property="BackgroundColor"
                                                Value="#FFEBEB"/>
                                    </DataTrigger>
                                </Border.Triggers>

                                <Grid ColumnDefinitions="*, Auto, Auto">

                                    <VerticalStackLayout>
                                        <Label Text="{Binding Descricao}"
                                               FontAttributes="Bold"/>
                                        <Label Text="{Binding DataVencimento, StringFormat='{0:dd/MM/yyyy}'}"
                                               FontSize="11"/>
                                    </VerticalStackLayout>

                                    <Label Grid.Column="1"
                                           Text="{Binding Valor, StringFormat='{0:C}'}"
                                           FontAttributes="Bold"
                                           VerticalOptions="Center"/>

                                    <HorizontalStackLayout Grid.Column="2"
                                                           Spacing="5">

                                        <Button Text="âœŽ"
                                                WidthRequest="32"
                                                HeightRequest="32"
                                                BackgroundColor="#F0F0F0"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FinanceiroViewModel}}, Path=EditarRegistroCommand}"
                                                CommandParameter="{Binding .}"/>

                                        <Button Text="X"
                                                WidthRequest="32"
                                                HeightRequest="32"
                                                BackgroundColor="#FFEBEB"
                                                TextColor="Red"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:FinanceiroViewModel}}, Path=ExcluirRegistroCommand}"
                                                CommandParameter="{Binding .}"/>
                                    </HorizontalStackLayout>

                                </Grid>
                            </Border>

                        </ContentView>

                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- PRODUÃ‡ÃƒO -->
            <VerticalStackLayout x:Name="ViewProducao"
                                 VerticalOptions="Center"
                                 HorizontalOptions="Center"
                                 IsVisible="False">

                <Label Text="Aba em ConstruÃ§Ã£o ðŸ—ï¸"
                       FontSize="20"
                       TextColor="#999"/>
            </VerticalStackLayout>

        </Grid>
    </Grid>
</ContentPage>