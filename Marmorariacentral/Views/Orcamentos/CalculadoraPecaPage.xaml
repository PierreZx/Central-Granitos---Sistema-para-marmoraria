<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Marmorariacentral.ViewModels"
             x:Class="Marmorariacentral.Views.Orcamentos.CalculadoraPecaPage"
             x:DataType="viewmodels:CalculadoraPecaViewModel"
             Title="Calculadora de PeÃ§a"
             BackgroundColor="#F2F2F7">

    <Grid ColumnDefinitions="420, *">
        
        <!-- COLUNA ESQUERDA -->
        <ScrollView Grid.Column="0" BackgroundColor="White">
            <VerticalStackLayout Padding="25" Spacing="20">

                <Label Text="Dados da PeÃ§a"
                       FontSize="22"
                       FontAttributes="Bold"
                       TextColor="#8B1A1A"/>

                <!-- AMBIENTE -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Ambiente" FontSize="14" TextColor="#666"/>
                    <Entry Text="{Binding Peca.Ambiente}"
                           BackgroundColor="#F9F9F9"/>
                </VerticalStackLayout>

                <!-- MATERIAL -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Material / Pedra" FontSize="14" TextColor="#666"/>
                    <Border StrokeShape="RoundRectangle 8"
                            StrokeThickness="1"
                            Stroke="#DDD">
                        <Picker ItemsSource="{Binding ListaEstoque}"
                                ItemDisplayBinding="{Binding DisplayInfo}"
                                SelectedItem="{Binding PedraSelecionada}"
                                HeightRequest="45"/>
                    </Border>
                </VerticalStackLayout>

                <!-- MEDIDAS PRINCIPAIS -->
                <VerticalStackLayout Spacing="10">
                    <VerticalStackLayout>
                        <Label Text="Largura (m)" FontSize="14" TextColor="#666"/>
                        <Entry Text="{Binding LarguraInput}"
                               Keyboard="Numeric"
                               BackgroundColor="#F9F9F9"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout>
                        <Label Text="Altura (m)" FontSize="14" TextColor="#666"/>
                        <Entry Text="{Binding AlturaInput}"
                               Keyboard="Numeric"
                               BackgroundColor="#F9F9F9"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>

                <!-- VALOR METRO LINEAR -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Valor do Metro Linear (R$)"
                           FontSize="14"
                           TextColor="#666"/>
                    <Entry Text="{Binding ValorMetroLinearInput}"
                           Keyboard="Numeric"
                           BackgroundColor="#F9F9F9"/>
                </VerticalStackLayout>

                <!-- MULTIPLICADOR -->
                <Frame BackgroundColor="#F5F5F5" Padding="15" CornerRadius="10">
                    <HorizontalStackLayout Spacing="15" HorizontalOptions="Center">
                        <CheckBox IsChecked="{Binding UsarMultiplicador}" />
                        <Label Text="Multiplicar peÃ§a principal"
                               FontAttributes="Bold"
                               VerticalOptions="Center"/>
                        <Entry Text="{Binding QuantidadeInput}"
                               Keyboard="Numeric"
                               WidthRequest="60"
                               BackgroundColor="White"
                               IsEnabled="{Binding UsarMultiplicador}"/>
                        <Label Text="vezes" 
                               VerticalOptions="Center"
                               IsVisible="{Binding UsarMultiplicador}"/>
                    </HorizontalStackLayout>
                </Frame>

                <BoxView HeightRequest="1" Color="#DDD"/>

                <!-- ===== SISTEMA DE ABAS ===== -->
                <FlexLayout JustifyContent="SpaceAround" Padding="5">
                    <Button Text="PRINCIPAL"
                            Command="{Binding MostrarAbaPrincipalCommand}"
                            BackgroundColor="Transparent"
                            TextColor="{Binding IsAbaPrincipalVisible, Converter={StaticResource BoolToColor}, ConverterParameter='#8B1A1A,#777'}"
                            FontAttributes="{Binding IsAbaPrincipalVisible, Converter={StaticResource BoolToBold}}"/>

                    <Button Text="RODOBANCA"
                            Command="{Binding MostrarAbaRodobancaCommand}"
                            BackgroundColor="Transparent"
                            TextColor="{Binding IsAbaRodobancaVisible, Converter={StaticResource BoolToColor}, ConverterParameter='#8B1A1A,#777'}"
                            FontAttributes="{Binding IsAbaRodobancaVisible, Converter={StaticResource BoolToBold}}"/>

                    <Button Text="SAIA"
                            Command="{Binding MostrarAbaSaiaCommand}"
                            BackgroundColor="Transparent"
                            TextColor="{Binding IsAbaSaiaVisible, Converter={StaticResource BoolToColor}, ConverterParameter='#8B1A1A,#777'}"
                            FontAttributes="{Binding IsAbaSaiaVisible, Converter={StaticResource BoolToBold}}"/>
                </FlexLayout>

                <!-- ===== ABA PRINCIPAL (BANCADAS L e U) ===== -->
                <VerticalStackLayout IsVisible="{Binding IsAbaPrincipalVisible}">

                    <!-- BANCADA EM L -->
                    <Label Text="BANCADA EM L"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#8B1A1A"
                           Margin="0,10,0,5"/>

                    <Picker ItemsSource="{Binding LadosDisponiveis}"
                            SelectedItem="{Binding LadoP2}" />
                    
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Largura (m)" FontSize="13" TextColor="#666"/>
                            <Entry Text="{Binding Peca2.Largura}"
                                   Keyboard="Numeric"
                                   BackgroundColor="#F9F9F9"
                                   Placeholder="0,00"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Altura (m)" FontSize="13" TextColor="#666"/>
                            <Entry Text="{Binding Peca2.Altura}"
                                   Keyboard="Numeric"
                                   BackgroundColor="#F9F9F9"
                                   Placeholder="0,00"/>
                        </VerticalStackLayout>
                    </Grid>

                    <BoxView HeightRequest="1" Color="#DDD" Margin="0,15"/>

                    <!-- BANCADA EM U -->
                    <Label Text="BANCADA EM U"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#8B1A1A"
                           Margin="0,0,0,5"/>

                    <Picker ItemsSource="{Binding LadosDisponiveis}"
                            SelectedItem="{Binding LadoP3}" />
                    
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                        <VerticalStackLayout Grid.Column="0">
                            <Label Text="Largura (m)" FontSize="13" TextColor="#666"/>
                            <Entry Text="{Binding Peca3.Largura}"
                                   Keyboard="Numeric"
                                   BackgroundColor="#F9F9F9"
                                   Placeholder="0,00"/>
                        </VerticalStackLayout>
                        <VerticalStackLayout Grid.Column="1">
                            <Label Text="Altura (m)" FontSize="13" TextColor="#666"/>
                            <Entry Text="{Binding Peca3.Altura}"
                                   Keyboard="Numeric"
                                   BackgroundColor="#F9F9F9"
                                   Placeholder="0,00"/>
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>

                <!-- ===== ABA RODOBANCA ===== -->
                <VerticalStackLayout IsVisible="{Binding IsAbaRodobancaVisible}" Spacing="20">

                    <!-- PEÃ‡A PRINCIPAL (P1) -->
                    <Frame BackgroundColor="#F8F8F8" Padding="15" CornerRadius="12">
                        <VerticalStackLayout Spacing="12">
                            <Label Text="ðŸ  PEÃ‡A PRINCIPAL" 
                                FontSize="15" 
                                FontAttributes="Bold" 
                                TextColor="#8B1A1A"/>
                            
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="15" RowSpacing="12">
                                <!-- Esquerda -->
                                <VerticalStackLayout Grid.Column="0" Grid.Row="0"
                                                    IsEnabled="{Binding IsP1EsquerdaColada, Converter={StaticResource InverseBoolConverter}}"
                                                    Opacity="{Binding IsP1EsquerdaColada, Converter={StaticResource BoolToOpacity}}">
                                    <Label Text="Esquerda (m)" FontSize="12" TextColor="{Binding IsP1EsquerdaColada, Converter={StaticResource BoolToGray}}"/>
                                    <Entry Text="{Binding RodobancaP1Esquerda}" 
                                        Keyboard="Numeric" 
                                        Placeholder="0,10"
                                        BackgroundColor="{Binding IsP1EsquerdaColada, Converter={StaticResource BoolToLightGray}}"/>
                                    <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                        IsVisible="{Binding IsP1EsquerdaColada}"/>
                                </VerticalStackLayout>
                                
                                <!-- Direita -->
                                <VerticalStackLayout Grid.Column="1" Grid.Row="0"
                                                    IsEnabled="{Binding IsP1DireitaColada, Converter={StaticResource InverseBoolConverter}}"
                                                    Opacity="{Binding IsP1DireitaColada, Converter={StaticResource BoolToOpacity}}">
                                    <Label Text="Direita (m)" FontSize="12" TextColor="{Binding IsP1DireitaColada, Converter={StaticResource BoolToGray}}"/>
                                    <Entry Text="{Binding RodobancaP1Direita}" 
                                        Keyboard="Numeric" 
                                        Placeholder="0,10"
                                        BackgroundColor="{Binding IsP1DireitaColada, Converter={StaticResource BoolToLightGray}}"/>
                                    <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                        IsVisible="{Binding IsP1DireitaColada}"/>
                                </VerticalStackLayout>
                                
                                <!-- Frente (Inferior) -->
                                <VerticalStackLayout Grid.Column="0" Grid.Row="1">
                                    <Label Text="Frente (m)" FontSize="12"/>
                                    <Entry Text="{Binding RodobancaP1Frente}" Keyboard="Numeric" Placeholder="0,10"/>
                                </VerticalStackLayout>
                                
                                <!-- TrÃ¡s (Superior) -->
                                <VerticalStackLayout Grid.Column="1" Grid.Row="1">
                                    <Label Text="TrÃ¡s (m)" FontSize="12"/>
                                    <Entry Text="{Binding RodobancaP1Tras}" Keyboard="Numeric" Placeholder="0,10"/>
                                </VerticalStackLayout>
                            </Grid>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- BANCADA EM L (P2) - SÃ“ APARECE SE TIVER MEDIDAS -->
                    <VerticalStackLayout IsVisible="{Binding Peca2.Largura, Converter={StaticResource DoubleMaiorQueZero}}">
                        <Frame BackgroundColor="#F0F8FF" Padding="15" CornerRadius="12">
                            <VerticalStackLayout Spacing="12">
                                <Label Text="ðŸ”· BANCADA EM L" 
                                    FontSize="15" 
                                    FontAttributes="Bold" 
                                    TextColor="#0066CC"/>
                                
                                <Grid ColumnDefinitions="*,*" ColumnSpacing="15" RowSpacing="12">
                                    <!-- Esquerda -->
                                    <VerticalStackLayout Grid.Column="0" Grid.Row="0"
                                                        IsEnabled="{Binding IsP2EsquerdaColada, Converter={StaticResource InverseBoolConverter}}"
                                                        Opacity="{Binding IsP2EsquerdaColada, Converter={StaticResource BoolToOpacity}}">
                                        <Label Text="Esquerda (m)" FontSize="12" TextColor="{Binding IsP2EsquerdaColada, Converter={StaticResource BoolToGray}}"/>
                                        <Entry Text="{Binding RodobancaP2Esquerda}" 
                                            Keyboard="Numeric" 
                                            Placeholder="0,10"
                                            BackgroundColor="{Binding IsP2EsquerdaColada, Converter={StaticResource BoolToLightGray}}"/>
                                        <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                            IsVisible="{Binding IsP2EsquerdaColada}"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- Direita -->
                                    <VerticalStackLayout Grid.Column="1" Grid.Row="0"
                                                        IsEnabled="{Binding IsP2DireitaColada, Converter={StaticResource InverseBoolConverter}}"
                                                        Opacity="{Binding IsP2DireitaColada, Converter={StaticResource BoolToOpacity}}">
                                        <Label Text="Direita (m)" FontSize="12" TextColor="{Binding IsP2DireitaColada, Converter={StaticResource BoolToGray}}"/>
                                        <Entry Text="{Binding RodobancaP2Direita}" 
                                            Keyboard="Numeric" 
                                            Placeholder="0,10"
                                            BackgroundColor="{Binding IsP2DireitaColada, Converter={StaticResource BoolToLightGray}}"/>
                                        <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                            IsVisible="{Binding IsP2DireitaColada}"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- Frente -->
                                    <VerticalStackLayout Grid.Column="0" Grid.Row="1">
                                        <Label Text="Frente (m)" FontSize="12"/>
                                        <Entry Text="{Binding RodobancaP2Frente}" Keyboard="Numeric" Placeholder="0,10"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- TrÃ¡s -->
                                    <VerticalStackLayout Grid.Column="1" Grid.Row="1">
                                        <Label Text="TrÃ¡s (m)" FontSize="12"/>
                                        <Entry Text="{Binding RodobancaP2Tras}" Keyboard="Numeric" Placeholder="0,10"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </VerticalStackLayout>
                        </Frame>
                    </VerticalStackLayout>

                    <!-- BANCADA EM U (P3) - SÃ“ APARECE SE TIVER MEDIDAS -->
                    <VerticalStackLayout IsVisible="{Binding Peca3.Largura, Converter={StaticResource DoubleMaiorQueZero}}">
                        <Frame BackgroundColor="#FFF0E0" Padding="15" CornerRadius="12">
                            <VerticalStackLayout Spacing="12">
                                <Label Text="ðŸ”¶ BANCADA EM U" 
                                    FontSize="15" 
                                    FontAttributes="Bold" 
                                    TextColor="#CC6600"/>
                                
                                <Grid ColumnDefinitions="*,*" ColumnSpacing="15" RowSpacing="12">
                                    <!-- Esquerda -->
                                    <VerticalStackLayout Grid.Column="0" Grid.Row="0"
                                                        IsEnabled="{Binding IsP3EsquerdaColada, Converter={StaticResource InverseBoolConverter}}"
                                                        Opacity="{Binding IsP3EsquerdaColada, Converter={StaticResource BoolToOpacity}}">
                                        <Label Text="Esquerda (m)" FontSize="12" TextColor="{Binding IsP3EsquerdaColada, Converter={StaticResource BoolToGray}}"/>
                                        <Entry Text="{Binding RodobancaP3Esquerda}" 
                                            Keyboard="Numeric" 
                                            Placeholder="0,10"
                                            BackgroundColor="{Binding IsP3EsquerdaColada, Converter={StaticResource BoolToLightGray}}"/>
                                        <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                            IsVisible="{Binding IsP3EsquerdaColada}"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- Direita -->
                                    <VerticalStackLayout Grid.Column="1" Grid.Row="0"
                                                        IsEnabled="{Binding IsP3DireitaColada, Converter={StaticResource InverseBoolConverter}}"
                                                        Opacity="{Binding IsP3DireitaColada, Converter={StaticResource BoolToOpacity}}">
                                        <Label Text="Direita (m)" FontSize="12" TextColor="{Binding IsP3DireitaColada, Converter={StaticResource BoolToGray}}"/>
                                        <Entry Text="{Binding RodobancaP3Direita}" 
                                            Keyboard="Numeric" 
                                            Placeholder="0,10"
                                            BackgroundColor="{Binding IsP3DireitaColada, Converter={StaticResource BoolToLightGray}}"/>
                                        <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                            IsVisible="{Binding IsP3DireitaColada}"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- Frente -->
                                    <VerticalStackLayout Grid.Column="0" Grid.Row="1">
                                        <Label Text="Frente (m)" FontSize="12"/>
                                        <Entry Text="{Binding RodobancaP3Frente}" Keyboard="Numeric" Placeholder="0,10"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- TrÃ¡s -->
                                    <VerticalStackLayout Grid.Column="1" Grid.Row="1">
                                        <Label Text="TrÃ¡s (m)" FontSize="12"/>
                                        <Entry Text="{Binding RodobancaP3Tras}" Keyboard="Numeric" Placeholder="0,10"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </VerticalStackLayout>
                        </Frame>
                    </VerticalStackLayout>
                </VerticalStackLayout>

                <!-- ===== ABA SAIA ===== -->
                <VerticalStackLayout IsVisible="{Binding IsAbaSaiaVisible}" Spacing="20">

                    <!-- PEÃ‡A PRINCIPAL (P1) -->
                    <Frame BackgroundColor="#F8F8F8" Padding="15" CornerRadius="12">
                        <VerticalStackLayout Spacing="12">
                            <Label Text="ðŸ  PEÃ‡A PRINCIPAL" 
                                FontSize="15" 
                                FontAttributes="Bold" 
                                TextColor="#8B1A1A"/>
                            
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="15" RowSpacing="12">
                                <!-- Esquerda -->
                                <VerticalStackLayout Grid.Column="0" Grid.Row="0"
                                                    IsEnabled="{Binding IsP1EsquerdaColada, Converter={StaticResource InverseBoolConverter}}"
                                                    Opacity="{Binding IsP1EsquerdaColada, Converter={StaticResource BoolToOpacity}}">
                                    <Label Text="Esquerda (m)" FontSize="12" TextColor="{Binding IsP1EsquerdaColada, Converter={StaticResource BoolToGray}}"/>
                                    <Entry Text="{Binding SaiaP1Esquerda}" 
                                        Keyboard="Numeric" 
                                        Placeholder="0,10"
                                        BackgroundColor="{Binding IsP1EsquerdaColada, Converter={StaticResource BoolToLightGray}}"/>
                                    <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                        IsVisible="{Binding IsP1EsquerdaColada}"/>
                                </VerticalStackLayout>
                                
                                <!-- Direita -->
                                <VerticalStackLayout Grid.Column="1" Grid.Row="0"
                                                    IsEnabled="{Binding IsP1DireitaColada, Converter={StaticResource InverseBoolConverter}}"
                                                    Opacity="{Binding IsP1DireitaColada, Converter={StaticResource BoolToOpacity}}">
                                    <Label Text="Direita (m)" FontSize="12" TextColor="{Binding IsP1DireitaColada, Converter={StaticResource BoolToGray}}"/>
                                    <Entry Text="{Binding SaiaP1Direita}" 
                                        Keyboard="Numeric" 
                                        Placeholder="0,10"
                                        BackgroundColor="{Binding IsP1DireitaColada, Converter={StaticResource BoolToLightGray}}"/>
                                    <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                        IsVisible="{Binding IsP1DireitaColada}"/>
                                </VerticalStackLayout>
                                
                                <!-- Frente -->
                                <VerticalStackLayout Grid.Column="0" Grid.Row="1">
                                    <Label Text="Frente (m)" FontSize="12"/>
                                    <Entry Text="{Binding SaiaP1Frente}" Keyboard="Numeric" Placeholder="0,10"/>
                                </VerticalStackLayout>
                                
                                <!-- TrÃ¡s -->
                                <VerticalStackLayout Grid.Column="1" Grid.Row="1">
                                    <Label Text="TrÃ¡s (m)" FontSize="12"/>
                                    <Entry Text="{Binding SaiaP1Tras}" Keyboard="Numeric" Placeholder="0,10"/>
                                </VerticalStackLayout>
                            </Grid>
                        </VerticalStackLayout>
                    </Frame>

                    <!-- BANCADA EM L (P2) -->
                    <VerticalStackLayout IsVisible="{Binding Peca2.Largura, Converter={StaticResource DoubleMaiorQueZero}}">
                        <Frame BackgroundColor="#F0F8FF" Padding="15" CornerRadius="12">
                            <VerticalStackLayout Spacing="12">
                                <Label Text="ðŸ”· BANCADA EM L" 
                                    FontSize="15" 
                                    FontAttributes="Bold" 
                                    TextColor="#0066CC"/>
                                
                                <Grid ColumnDefinitions="*,*" ColumnSpacing="15" RowSpacing="12">
                                    <!-- Esquerda -->
                                    <VerticalStackLayout Grid.Column="0" Grid.Row="0"
                                                        IsEnabled="{Binding IsP2EsquerdaColada, Converter={StaticResource InverseBoolConverter}}"
                                                        Opacity="{Binding IsP2EsquerdaColada, Converter={StaticResource BoolToOpacity}}">
                                        <Label Text="Esquerda (m)" FontSize="12" TextColor="{Binding IsP2EsquerdaColada, Converter={StaticResource BoolToGray}}"/>
                                        <Entry Text="{Binding SaiaP2Esquerda}" 
                                            Keyboard="Numeric" 
                                            Placeholder="0,10"
                                            BackgroundColor="{Binding IsP2EsquerdaColada, Converter={StaticResource BoolToLightGray}}"/>
                                        <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                            IsVisible="{Binding IsP2EsquerdaColada}"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- Direita -->
                                    <VerticalStackLayout Grid.Column="1" Grid.Row="0"
                                                        IsEnabled="{Binding IsP2DireitaColada, Converter={StaticResource InverseBoolConverter}}"
                                                        Opacity="{Binding IsP2DireitaColada, Converter={StaticResource BoolToOpacity}}">
                                        <Label Text="Direita (m)" FontSize="12" TextColor="{Binding IsP2DireitaColada, Converter={StaticResource BoolToGray}}"/>
                                        <Entry Text="{Binding SaiaP2Direita}" 
                                            Keyboard="Numeric" 
                                            Placeholder="0,10"
                                            BackgroundColor="{Binding IsP2DireitaColada, Converter={StaticResource BoolToLightGray}}"/>
                                        <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                            IsVisible="{Binding IsP2DireitaColada}"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- Frente -->
                                    <VerticalStackLayout Grid.Column="0" Grid.Row="1">
                                        <Label Text="Frente (m)" FontSize="12"/>
                                        <Entry Text="{Binding SaiaP2Frente}" Keyboard="Numeric" Placeholder="0,10"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- TrÃ¡s -->
                                    <VerticalStackLayout Grid.Column="1" Grid.Row="1">
                                        <Label Text="TrÃ¡s (m)" FontSize="12"/>
                                        <Entry Text="{Binding SaiaP2Tras}" Keyboard="Numeric" Placeholder="0,10"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </VerticalStackLayout>
                        </Frame>
                    </VerticalStackLayout>

                    <!-- BANCADA EM U (P3) -->
                    <VerticalStackLayout IsVisible="{Binding Peca3.Largura, Converter={StaticResource DoubleMaiorQueZero}}">
                        <Frame BackgroundColor="#FFF0E0" Padding="15" CornerRadius="12">
                            <VerticalStackLayout Spacing="12">
                                <Label Text="ðŸ”¶ BANCADA EM U" 
                                    FontSize="15" 
                                    FontAttributes="Bold" 
                                    TextColor="#CC6600"/>
                                
                                <Grid ColumnDefinitions="*,*" ColumnSpacing="15" RowSpacing="12">
                                    <!-- Esquerda -->
                                    <VerticalStackLayout Grid.Column="0" Grid.Row="0"
                                                        IsEnabled="{Binding IsP3EsquerdaColada, Converter={StaticResource InverseBoolConverter}}"
                                                        Opacity="{Binding IsP3EsquerdaColada, Converter={StaticResource BoolToOpacity}}">
                                        <Label Text="Esquerda (m)" FontSize="12" TextColor="{Binding IsP3EsquerdaColada, Converter={StaticResource BoolToGray}}"/>
                                        <Entry Text="{Binding SaiaP3Esquerda}" 
                                            Keyboard="Numeric" 
                                            Placeholder="0,10"
                                            BackgroundColor="{Binding IsP3EsquerdaColada, Converter={StaticResource BoolToLightGray}}"/>
                                        <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                            IsVisible="{Binding IsP3EsquerdaColada}"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- Direita -->
                                    <VerticalStackLayout Grid.Column="1" Grid.Row="0"
                                                        IsEnabled="{Binding IsP3DireitaColada, Converter={StaticResource InverseBoolConverter}}"
                                                        Opacity="{Binding IsP3DireitaColada, Converter={StaticResource BoolToOpacity}}">
                                        <Label Text="Direita (m)" FontSize="12" TextColor="{Binding IsP3DireitaColada, Converter={StaticResource BoolToGray}}"/>
                                        <Entry Text="{Binding SaiaP3Direita}" 
                                            Keyboard="Numeric" 
                                            Placeholder="0,10"
                                            BackgroundColor="{Binding IsP3DireitaColada, Converter={StaticResource BoolToLightGray}}"/>
                                        <Label Text="ðŸ”’ Colado" FontSize="10" TextColor="#999" 
                                            IsVisible="{Binding IsP3DireitaColada}"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- Frente -->
                                    <VerticalStackLayout Grid.Column="0" Grid.Row="1">
                                        <Label Text="Frente (m)" FontSize="12"/>
                                        <Entry Text="{Binding SaiaP3Frente}" Keyboard="Numeric" Placeholder="0,10"/>
                                    </VerticalStackLayout>
                                    
                                    <!-- TrÃ¡s -->
                                    <VerticalStackLayout Grid.Column="1" Grid.Row="1">
                                        <Label Text="TrÃ¡s (m)" FontSize="12"/>
                                        <Entry Text="{Binding SaiaP3Tras}" Keyboard="Numeric" Placeholder="0,10"/>
                                    </VerticalStackLayout>
                                </Grid>
                            </VerticalStackLayout>
                        </Frame>
                    </VerticalStackLayout>
                </VerticalStackLayout>

                <BoxView HeightRequest="1" Color="#DDD"/>

                <!-- TOTAL GERAL -->
                <Frame BackgroundColor="#E3F2FD"
                       BorderColor="#1565C0"
                       Padding="15"
                       CornerRadius="12">
                    <VerticalStackLayout HorizontalOptions="Center">
                        <Label Text="Total Geral"
                               FontSize="14"
                               TextColor="#0D47A1"/>
                        <Label Text="{Binding TotalGeral, StringFormat='{0:C}'}"
                               FontSize="26"
                               FontAttributes="Bold"
                               TextColor="#0D47A1"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- BOTÃƒO SALVAR -->
                <Button Text="ADICIONAR AO ORÃ‡AMENTO"
                        Command="{Binding SalvarPecaCommand}"
                        BackgroundColor="#8B1A1A"
                        TextColor="White"
                        HeightRequest="55"
                        FontAttributes="Bold"
                        CornerRadius="12"/>

            </VerticalStackLayout>
        </ScrollView>

        <!-- COLUNA DIREITA (DESENHO) -->
        <Grid Grid.Column="1"
              BackgroundColor="#ECEFF1"
              Padding="20">

            <Frame BackgroundColor="White"
                   CornerRadius="24"
                   HasShadow="True"
                   Padding="20"
                   HorizontalOptions="Center"
                   VerticalOptions="Center"
                   WidthRequest="700"
                   HeightRequest="650">

                <Grid RowDefinitions="Auto, *, Auto" RowSpacing="12">
                    
                    <Label Grid.Row="0"
                           Text="PrÃ©-visualizaÃ§Ã£o TÃ©cnica da Bancada"
                           FontSize="20"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="#2C3E50"/>

                    <Border Grid.Row="1"
                            Stroke="#CCCCCC"
                            StrokeThickness="1.5"
                            StrokeShape="RoundRectangle 16"
                            BackgroundColor="#FFFFFF"
                            Margin="0,10,0,10">

                        <GraphicsView x:Name="CanvasPeca"
                                      Drawable="{Binding DesenhoPeca}"
                                      InputTransparent="True"
                                      HorizontalOptions="Fill"
                                      VerticalOptions="Fill"/>
                    </Border>

                    <VerticalStackLayout Grid.Row="2" Spacing="8">
                        <HorizontalStackLayout HorizontalOptions="Center" Spacing="25">
                            <Label Text="â¬œ Principal" FontSize="12" TextColor="#555"/>
                            <Label Text="ðŸŸ¦ Perna" FontSize="12" TextColor="#555"/>
                            <Label Text="ðŸŸ© Rodobanca" FontSize="12" TextColor="#2E7D32"/>
                            <Label Text="ðŸŸ¨ Saia" FontSize="12" TextColor="#B76E00"/>
                        </HorizontalStackLayout>
                        <Label Text="Medidas em metros - Desenho tÃ©cnico ilustrativo"
                               FontSize="11"
                               TextColor="#888"
                               HorizontalOptions="Center"/>
                    </VerticalStackLayout>
                </Grid>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>