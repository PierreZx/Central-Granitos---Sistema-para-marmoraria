<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Marmorariacentral.ViewModels"
             x:Class="Marmorariacentral.Views.Orcamentos.CalculadoraPecaPage"
             x:DataType="viewmodels:CalculadoraPecaViewModel"
             Title="Calculadora de Peça"
             BackgroundColor="#F2F2F7">

    <Grid ColumnSpacing="0">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="{OnIdiom Default='*', Desktop='400'}" />
            <ColumnDefinition Width="{OnIdiom Default='0', Desktop='*'}" />
        </Grid.ColumnDefinitions>

        <ScrollView Grid.Column="0" BackgroundColor="White">
            <VerticalStackLayout Padding="25" Spacing="20">

                <!-- TÍTULO -->
                <Label Text="Dados da Peça"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="#8B1A1A"/>

                <!-- AMBIENTE -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Ambiente" FontSize="14" TextColor="#666"/>
                    <Entry Placeholder="Ex: Cozinha, Lavatório Suíte"
                           Text="{Binding Peca.Ambiente}"
                           BackgroundColor="#F9F9F9"/>
                </VerticalStackLayout>

                <!-- MATERIAL -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Material / Pedra" FontSize="14" TextColor="#666"/>
                    <Border StrokeShape="RoundRectangle 5"
                            StrokeThickness="1"
                            Stroke="#DDD">
                        <Picker Title="Selecione o material"
                                ItemsSource="{Binding ListaEstoque}"
                                ItemDisplayBinding="{Binding DisplayInfo}"
                                SelectedItem="{Binding PedraSelecionada}"
                                HeightRequest="45"/>
                    </Border>
                </VerticalStackLayout>

                <!-- MEDIDAS -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="15">

                    <!-- LARGURA -->
                    <VerticalStackLayout Grid.Column="0" Spacing="5">
                        <Label Text="Largura (m)" FontSize="14" TextColor="#666"/>
                        <Entry Text="{Binding LarguraInput}"
                               Keyboard="Numeric"
                               BackgroundColor="#F9F9F9"/>
                    </VerticalStackLayout>

                    <!-- ALTURA -->
                    <VerticalStackLayout Grid.Column="1" Spacing="5">
                        <Label Text="Altura (m)" FontSize="14" TextColor="#666"/>
                        <Entry Text="{Binding AlturaInput}"
                               Keyboard="Numeric"
                               BackgroundColor="#F9F9F9"/>
                    </VerticalStackLayout>

                </Grid>

                <!-- METRO LINEAR -->
                <VerticalStackLayout Spacing="5">
                    <Label Text="Valor do Metro Linear (R$)"
                           FontSize="14"
                           TextColor="#666"/>
                    <Entry Text="{Binding ValorMetroLinearInput}"
                           Keyboard="Numeric"
                           BackgroundColor="#F9F9F9"/>
                </VerticalStackLayout>

                <!-- MULTIPLICADOR -->
                <VerticalStackLayout Spacing="5">
                    <HorizontalStackLayout Spacing="10">
                        <CheckBox IsChecked="{Binding UsarMultiplicador}" />
                        <Label Text="Repetir esta peça"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <Entry Placeholder="Quantidade"
                           Text="{Binding QuantidadeInput}"
                           Keyboard="Numeric"
                           IsEnabled="{Binding UsarMultiplicador}"
                           BackgroundColor="#F9F9F9"/>
                </VerticalStackLayout>

                <!-- VALOR PEDRA -->
                <Frame BackgroundColor="#E8F5E9"
                       BorderColor="#2E7D32"
                       Padding="15"
                       CornerRadius="10">
                    <VerticalStackLayout HorizontalOptions="Center" Spacing="5">
                        <Label Text="Valor da Pedra"
                               FontSize="13"
                               TextColor="#2E7D32"/>
                        <Label Text="{Binding ValorMaterial, StringFormat='{0:C}'}"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="#1B5E20"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- MÃO DE OBRA -->
                <Frame BackgroundColor="#FFF3E0"
                       BorderColor="#EF6C00"
                       Padding="15"
                       CornerRadius="10">
                    <VerticalStackLayout HorizontalOptions="Center" Spacing="5">
                        <Label Text="Mão de Obra"
                               FontSize="13"
                               TextColor="#E65100"/>
                        <Label Text="{Binding ValorMaoDeObra, StringFormat='{0:C}'}"
                               FontSize="20"
                               FontAttributes="Bold"
                               TextColor="#BF360C"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- TOTAL GERAL -->
                <Frame BackgroundColor="#E3F2FD"
                       BorderColor="#1565C0"
                       Padding="15"
                       CornerRadius="10">
                    <VerticalStackLayout HorizontalOptions="Center" Spacing="5">
                        <Label Text="Total Geral"
                               FontSize="13"
                               TextColor="#0D47A1"/>
                        <Label Text="{Binding TotalGeral, StringFormat='{0:C}'}"
                               FontSize="24"
                               FontAttributes="Bold"
                               TextColor="#0D47A1"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- BOTÃO -->
                <Button Text="ADICIONAR AO ORÇAMENTO"
                        Command="{Binding SalvarPecaCommand}"
                        BackgroundColor="#8B1A1A"
                        TextColor="White"
                        HeightRequest="55"
                        FontAttributes="Bold"
                        CornerRadius="10"/>

            </VerticalStackLayout>
        </ScrollView>

        <!-- VISUALIZAÇÃO DESKTOP -->
        <Grid Grid.Column="1"
              BackgroundColor="#F2F2F7"
              Padding="40"
              IsVisible="{OnIdiom Desktop=True, Default=False}">

            <VerticalStackLayout Spacing="15" VerticalOptions="Center">
                <Label Text="Visualização da Peça (2D)"
                       FontSize="16"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"/>

                <Border StrokeShape="RoundRectangle 20"
                        StrokeThickness="2"
                        Stroke="#DDD"
                        BackgroundColor="White"
                        HeightRequest="450"
                        WidthRequest="550"
                        HorizontalOptions="Center">

                    <GraphicsView x:Name="CanvasPeca"
                                  Drawable="{Binding DesenhoPeca}"
                                  InputTransparent="True"/>
                </Border>

                <Label Text="As medidas são ilustrativas para conferência."
                       FontSize="12"
                       TextColor="#999"
                       HorizontalOptions="Center"/>
            </VerticalStackLayout>
        </Grid>

    </Grid>
</ContentPage>
